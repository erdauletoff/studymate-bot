# Profile Statistics & Learning Streak Feature

## –ß—Ç–æ –¥–æ–±–∞–≤–ª–µ–Ω–æ

### 1. Learning Streak (–°–µ—Ä–∏—è –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥)
–ú–æ—Ç–∏–≤–∞—Ü–∏–æ–Ω–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ–π –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç–∏ —Å—Ç—É–¥–µ–Ω—Ç–∞.

**–ü–æ–ª—è –≤ –º–æ–¥–µ–ª–∏ Student:**
- `current_streak` ‚Äî —Ç–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
- `longest_streak` ‚Äî —Ä–µ–∫–æ—Ä–¥–Ω–∞—è —Å–µ—Ä–∏—è –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
- `last_quiz_date` ‚Äî –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –ø—Ä–æ–π–¥–µ–Ω–Ω–æ–≥–æ –∫–≤–∏–∑–∞

**–õ–æ–≥–∏–∫–∞:**
- –ü—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –∫–≤–∏–∑–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –¥–∞—Ç–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ –∫–≤–∏–∑–∞
- –ï—Å–ª–∏ –≤—á–µ—Ä–∞ –±—ã–ª –∫–≤–∏–∑ ‚Üí —Å–µ—Ä–∏—è –ø—Ä–æ–¥–æ–ª–∂–∞–µ—Ç—Å—è (+1 –¥–µ–Ω—å)
- –ï—Å–ª–∏ —Å–µ–≥–æ–¥–Ω—è —É–∂–µ –±—ã–ª –∫–≤–∏–∑ ‚Üí —Å–µ—Ä–∏—è –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è
- –ï—Å–ª–∏ –ø–µ—Ä–µ—Ä—ã–≤ > 1 –¥–Ω—è ‚Üí —Å–µ—Ä–∏—è —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ 1
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è —Ä–µ–∫–æ—Ä–¥ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏

**–û–±–Ω–æ–≤–ª–µ–Ω–∏–µ:**
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø—Ä–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏–∏ –ª—é–±–æ–≥–æ –∫–≤–∏–∑–∞ (ranked –∏–ª–∏ practice)
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `finish_quiz_attempt()` –≤ `bot/db.py`

### 2. –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ —É—Å–ø–µ–≤–∞–µ–º–æ—Å—Ç–∏
–î–µ—Ç–∞–ª—å–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ –≤—Å–µ–º –ø—Ä–æ–π–¥–µ–Ω–Ω—ã–º –∫–≤–∏–∑–∞–º.

**–ú–µ—Ç–æ–¥ `get_quiz_stats()` –≤ –º–æ–¥–µ–ª–∏ Student –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç:**
```python
{
    'total_quizzes': 8,        # –í—Å–µ–≥–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö –∫–≤–∏–∑–æ–≤
    'total_ranked': 1,         # Ranked –∫–≤–∏–∑–æ–≤
    'total_practice': 7,       # Practice –∫–≤–∏–∑–æ–≤
    'avg_score': 4.5,          # –°—Ä–µ–¥–Ω–∏–π –±–∞–ª–ª (raw)
    'avg_percentage': 44.5,    # –°—Ä–µ–¥–Ω–∏–π –ø—Ä–æ—Ü–µ–Ω—Ç
    'best_score': 9,           # –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–±–∞–ª–ª)
    'best_total': 10,          # –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–≤—Å–µ–≥–æ –≤–æ–ø—Ä–æ—Å–æ–≤)
    'best_percentage': 90.0    # –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç (–ø—Ä–æ—Ü–µ–Ω—Ç)
}
```

### 3. –û–±–Ω–æ–≤–ª–µ–Ω–Ω—ã–π –ø—Ä–æ—Ñ–∏–ª—å —Å—Ç—É–¥–µ–Ω—Ç–∞
–ü—Ä–æ—Ñ–∏–ª—å —Ç–µ–ø–µ—Ä—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç:

**–ë–∞–∑–æ–≤–∞—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è:**
- –§–ò–û
- Telegram username
- –î–∞—Ç–∞ –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è
- –Ø–∑—ã–∫ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
- –ú–µ–Ω—Ç–æ—Ä

**–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞:**
- –í—Å–µ–≥–æ –∫–≤–∏–∑–æ–≤ (—Å —Ä–∞–∑–±–∏–≤–∫–æ–π –Ω–∞ ranked/practice)
- –°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç –≤ –ø—Ä–æ—Ü–µ–Ω—Ç–∞—Ö
- –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç

**Learning Streak:**
- üî• –¢–µ–∫—É—â–∞—è —Å–µ—Ä–∏—è (–¥–Ω–µ–π –ø–æ–¥—Ä—è–¥)
- üèÖ –†–µ–∫–æ—Ä–¥–Ω–∞—è —Å–µ—Ä–∏—è

**–≠–º–æ–¥–∑–∏ streak:**
- üî• ‚Äî –µ—Å–ª–∏ streak > 0
- üí§ ‚Äî –µ—Å–ª–∏ streak = 0

## –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω—ã

### Backend
- `backend/students/models.py` ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã –ø–æ–ª—è streak –∏ –º–µ—Ç–æ–¥ `get_quiz_stats()`
- `backend/students/migrations/0004_...py` ‚Äî –º–∏–≥—Ä–∞—Ü–∏—è –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª–µ–π

### Bot
- `bot/db.py`:
  - `finish_quiz_attempt()` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –∞–≤—Ç–æ–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è streak
  - `get_student_quiz_stats()` ‚Äî –Ω–æ–≤–∞—è —Ñ—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
  - `update_student_streak()` ‚Äî –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω–∞—è —Ñ—É–Ω–∫—Ü–∏—è (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å, —Ç.–∫. –ª–æ–≥–∏–∫–∞ –≤ finish_quiz_attempt)

- `bot/handlers/profile.py`:
  - `view_profile()` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏ streak

- `bot/texts.py`:
  - `profile_view` ‚Äî –æ–±–Ω–æ–≤–ª–µ–Ω –¥–ª—è —Ç—Ä–µ—Ö —è–∑—ã–∫–æ–≤ (ru, qq, en)

## –ú–∏–≥—Ä–∞—Ü–∏–∏
```bash
python manage.py makemigrations students
python manage.py migrate students
```

–ú–∏–≥—Ä–∞—Ü–∏—è —Å–æ–∑–¥–∞–Ω–∞: `0004_student_current_streak_student_last_quiz_date_and_more.py`

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –º–æ–¥–µ–ª–∏:
```bash
python manage.py shell -c "from backend.students.models import Student; s = Student.objects.first(); print(s.get_quiz_stats())"
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ streak:
```bash
python manage.py shell -c "from backend.students.models import Student; s = Student.objects.first(); print(f'Streak: {s.current_streak}, Record: {s.longest_streak}')"
```

## –ü—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è

### –í –ø—Ä–æ—Ñ–∏–ª–µ —Å—Ç—É–¥–µ–Ω—Ç–∞:
1. –°—Ç—É–¥–µ–Ω—Ç –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç "üë§ –ü—Ä–æ—Ñ–∏–ª—å"
2. –í–∏–¥–∏—Ç –ø–æ–ª–Ω—É—é —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫—É
3. –í–∏–¥–∏—Ç —Ç–µ–∫—É—â—É—é —Å–µ—Ä–∏—é –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥
4. –ú–æ—Ç–∏–≤–∏—Ä—É–µ—Ç—Å—è –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —É—á–∏—Ç—å—Å—è –µ–∂–µ–¥–Ω–µ–≤–Ω–æ

### Streak –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏:
- –°—Ç—É–¥–µ–Ω—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –∫–≤–∏–∑ —Å–µ–≥–æ–¥–Ω—è –ø–µ—Ä–≤—ã–π —Ä–∞–∑ ‚Üí streak = 1
- –°—Ç—É–¥–µ–Ω—Ç –ø—Ä–æ—Ö–æ–¥–∏—Ç –∫–≤–∏–∑ –∑–∞–≤—Ç—Ä–∞ ‚Üí streak = 2
- –°—Ç—É–¥–µ–Ω—Ç –ø—Ä–æ–ø—É—Å–∫–∞–µ—Ç –¥–µ–Ω—å ‚Üí streak —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ 1
- –†–µ–∫–æ—Ä–¥ –≤—Å–µ–≥–¥–∞ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è

## –£–ª—É—á—à–µ–Ω–∏—è –≤ –±—É–¥—É—â–µ–º

### –í–æ–∑–º–æ–∂–Ω—ã–µ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏—è:
1. **–£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ streak**
   - "–í–∞—à–∞ —Å–µ—Ä–∏—è: 5 –¥–Ω–µ–π! –ü—Ä–æ–¥–æ–ª–∂–∞–π—Ç–µ –≤ —Ç–æ–º –∂–µ –¥—É—Ö–µ!"
   - "–ù–µ —Ç–µ—Ä—è–π—Ç–µ —Å–µ—Ä–∏—é! –ü–æ—Å–ª–µ–¥–Ω–∏–π –∫–≤–∏–∑ –±—ã–ª –≤—á–µ—Ä–∞"

2. **–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è –∑–∞ streak**
   - üî• 7 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ ‚Üí "–ù–µ–¥–µ–ª—è —É—Å–ø–µ—Ö–∞"
   - üî• 30 –¥–Ω–µ–π –ø–æ–¥—Ä—è–¥ ‚Üí "–ú–µ—Å—è—Ü —É–ø–æ—Ä—Å—Ç–≤–∞"

3. **–ì—Ä–∞—Ñ–∏–∫ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞**
   - –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –ø–æ –¥–∞—Ç–∞–º
   - –ò—Å—Ç–æ—Ä–∏—è –ø–æ—Å–ª–µ–¥–Ω–∏—Ö 10 –∫–≤–∏–∑–æ–≤

4. **–°—Ä–∞–≤–Ω–µ–Ω–∏–µ —Å –¥—Ä—É–≥–∏–º–∏**
   - "–í—ã –≤ —Ç–æ–ø-10% –ø–æ streak —Å—Ä–µ–¥–∏ –≤—Å–µ—Ö —Å—Ç—É–¥–µ–Ω—Ç–æ–≤"

5. **–ö–∞—Ç–µ–≥–æ—Ä–∏–∏ –∫–≤–∏–∑–æ–≤**
   - –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ø–æ —Ç–µ–º–∞–º/–∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
   - –°–ª–∞–±—ã–µ –∏ —Å–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã

## –õ–æ–∫–∞–ª–∏–∑–∞—Ü–∏—è
–í—Å–µ —Ç–µ–∫—Å—Ç—ã –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ 3 —è–∑—ã–∫–∞:
- üá∑üá∫ –†—É—Å—Å–∫–∏–π
- üá∫üáø Qaraqalpaq (–ö–∞—Ä–∞–∫–∞–ª–ø–∞–∫—Å–∫–∏–π)
- üá¨üáß English

## –§–æ—Ä–º–∞—Ç –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è

### –†—É—Å—Å–∫–∏–π:
```
üë§ –í–∞—à –ø—Ä–æ—Ñ–∏–ª—å

üìù –§–ò–û: –ò–≤–∞–Ω–æ–≤ –ò–≤–∞–Ω
üì± Telegram: @ivan
üìÖ –í –±–æ—Ç–µ —Å: 15.01.2026
üåê –Ø–∑—ã–∫: –†—É—Å—Å–∫–∏–π
üìä –ú–µ–Ω—Ç–æ—Ä: –ü–µ—Ç—Ä–æ–≤ –ü.–ü.

üìà –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üìö –í—Å–µ–≥–æ –∫–≤–∏–∑–æ–≤: 8
  ‚îú üèÜ Ranked: 1
  ‚îî üìù Practice: 7

üìä –°—Ä–µ–¥–Ω–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 44.5%
üéØ –õ—É—á—à–∏–π —Ä–µ–∑—É–ª—å—Ç–∞—Ç: 9/10 (90.0%)

üî• –°–µ—Ä–∏—è
‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ‚îÅ
üî• –¢–µ–∫—É—â–∞—è: 3 –¥–Ω.
üèÖ –†–µ–∫–æ—Ä–¥: 5 –¥–Ω.
```

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è

### –†–∞—Å—á–µ—Ç streak:
```python
today = date.today()

if last_quiz_date is None:
    current_streak = 1
elif last_quiz_date == today:
    # –£–∂–µ –±—ã–ª –∫–≤–∏–∑ —Å–µ–≥–æ–¥–Ω—è
    pass
elif last_quiz_date == yesterday:
    # –ö–≤–∏–∑ –±—ã–ª –≤—á–µ—Ä–∞ - –ø—Ä–æ–¥–æ–ª–∂–∞–µ–º —Å–µ—Ä–∏—é
    current_streak += 1
    longest_streak = max(current_streak, longest_streak)
else:
    # –ü–µ—Ä–µ—Ä—ã–≤ > 1 –¥–Ω—è - —Å–±—Ä–∞—Å—ã–≤–∞–µ–º
    current_streak = 1

last_quiz_date = today
```

### –†–∞—Å—á–µ—Ç —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è Django ORM aggregates (Avg, Max)
- –°—á–∏—Ç–∞—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—ã–µ –ø–æ–ø—ã—Ç–∫–∏ (finished_at != NULL)
- –£–Ω–∏–∫–∞–ª—å–Ω—ã–µ –∫–≤–∏–∑—ã –æ–ø—Ä–µ–¥–µ–ª—è—é—Ç—Å—è –ø–æ quiz_id
- –ü—Ä–æ—Ü–µ–Ω—Ç–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –æ–∫—Ä—É–≥–ª—è—é—Ç—Å—è –¥–æ 1 –∑–Ω–∞–∫–∞ –ø–æ—Å–ª–µ –∑–∞–ø—è—Ç–æ–π
